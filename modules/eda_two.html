<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="/rworkshop/assets/css/style.css">
<link rel="stylesheet" href="/rworkshop/assets/css/syntax_default.css">
<link rel="stylesheet" href="/rworkshop/assets/leaflet/leaflet.css" />
<script defer src="/rworkshop/assets/js/fontawesome-all.js"></script>
<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Workshop on R<a href="https://github.com/btskinner/rworkshop" class="iconlink">
	      <i class="fab fa-github fa-xs"></i></a></h1>
	<h2 class="thin">May 2018</h2>
	<p>Hosted by Virginia Education Science Training (VEST) Program at UVA</p>
	
        <p>
	  <a href="https://curry.virginia.edu/faculty-research/centers-labs-projects/edpolicyworks">
	    <img src="https://curry.virginia.edu/sites/default/files/uploads/epw/EdPolicyWork%20horz%20logo%20high%20res.png" style="width:100%;">
	  </a>
	</p>
	<h2 class="thin">
	  <a href="/rworkshop/">Overview</a></br>
	  <a href="/rworkshop/schedule/">Schedule</a></br>
	  <a href="/rworkshop/start/">Getting started</a></br>
	  <a href="/rworkshop/modules/">Modules</a></br>
	  <a href="/rworkshop/data/">Data</a></br>
	</h2>
      </header>

      <section>

      <h1>Exploratory data analysis II</h1>


<p>
  
  <a href="/rworkshop/scripts/eda_two.R"
     class="iconlink" download title="Get script">
    <i class="fas fa-code fa-2x"></i>
  </a>
  &nbsp;&nbsp;
  
  
  
  
  <a href="/rworkshop/data/els_plans.dta"
     class="iconlink" download title="Get data">
    <i class="fas fa-database fa-2x"></i>
  </a>
  
</p>


<p>Another key part of exploratory data analysis is making plots that let
you visually inspect the data. This module will focus on graphics.</p>

<p>R has three major graphing systems: the <a href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/00Index.html">base
system</a>,
<a href="http://lattice.r-forge.r-project.org">lattice</a>, and
<a href="http://ggplot2.tidyverse.org">ggplot2</a>. Each system has its benefits
and drawbacks and each is also very versatile with many, many options
for creating and adjusting plots.</p>

<p>Unfortunately, there isn’t enough time to go through all three graphing
systems. After describing a few base R graphing functions, this module
will focus on ggplot2 since it allows users to build plots using the
<a href="http://vita.had.co.nz/papers/layered-grammar.html">grammar of graphics</a>
and integrates well with the tidyverse.</p>

<p>We’ll use the same ELS plans data we’ve been using, again in Stata
format since it has variable and value labels.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">haven</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">labelled</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## read in Stata data file</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_dta</span><span class="p">(</span><span class="s1">'../data/els_plans.dta'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h1 id="plots-using-base-r">Plots using base R</h1>

<p>Even though users have developed new graphics libraries, the base R
graphics system is still very powerful. It’s also very easy to use in a
pinch. When I want a quick visual of a data distribution that’s just for
me, I generally use base R.</p>

<h2 id="histogram">Histogram</h2>

<p>For continuous variables, a histogram is a useful plot. Though the
<code class="highlighter-rouge">hist()</code> function has many options to adjust how it looks, the defaults
work really well.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## histogram of math scores</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bynels2m</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_base_histogram-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise">Quick exercise</h4>

  <p>Check the distribution of reading scores.</p>
</blockquote>

<h2 id="density">Density</h2>

<p>Density plots are also really helpful. R doesn’t have single density
plot function, but you can get a density plot in one of two ways, each
of which will give a slightly different result.</p>

<p>First, you can adjust the <code class="highlighter-rouge">hist()</code> function to add the <code class="highlighter-rouge">freq = FALSE</code>
argument. It looks like the first histogram above, but notice that the
y-axis now represents density rather than counts.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## density plot of math scores with hist() function</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_base_hist_density-1.png" width="100%" /></p>

<p>Second, you can <code class="highlighter-rouge">plot()</code> the <code class="highlighter-rouge">density()</code> of a continuous variable.
Unlike <code class="highlighter-rouge">hist()</code>, however, <code class="highlighter-rouge">density()</code> doesn’t automatically ignore
missing values, so we have to tell it to remove <code class="highlighter-rouge">NA</code>s.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## density plot of math scores</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_base_density-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-1">Quick exercise</h4>

  <p>Plot the density of reading scores. Next, try to use the <code class="highlighter-rouge">col</code>
argument in <code class="highlighter-rouge">plot()</code> to change the color of the line to <code class="highlighter-rouge">'red'</code>.</p>
</blockquote>

<h2 id="box-plot">Box plot</h2>

<p>Call a box plot using the <code class="highlighter-rouge">boxplot()</code> function. This one is a little
trickier because it uses the <a href="https://www.statmethods.net/graphs/boxplot.html">R
formula</a> construction
to set the continuous variable against the group. (We’ll talk more about
formulas in the module on modeling.) The formula uses a tilde, <code class="highlighter-rouge">~</code>, and
should be constructed like this:</p>

<ul>
  <li><code class="highlighter-rouge">&lt;var&gt; ~ &lt;group var&gt;</code></li>
</ul>

<p>Notice how we can use the <code class="highlighter-rouge">data</code> argument instead of adding <code class="highlighter-rouge">df$</code> in
front of the variable names.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## box plot of math scores against student expectations</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">bynels2m</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">bystexp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_base_box-1.png" width="100%" /></p>

<h2 id="scatter">Scatter</h2>

<p>Finally, plot continuous variables against one another using the base
<code class="highlighter-rouge">plot()</code> function. There are two primary ways to make a scatter plot
using <code class="highlighter-rouge">plot()</code>:</p>

<ul>
  <li><code class="highlighter-rouge">plot(x, y)</code></li>
  <li><code class="highlighter-rouge">plot(y ~ x)</code></li>
</ul>

<p>With both, <code class="highlighter-rouge">x</code> is the variable that will go on the x-axis and <code class="highlighter-rouge">y</code> the
one that will go on the y-axis. It’s really a matter of which makes
sense to you. We’ll use the first.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## scatter plot of math against reading scores</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">bynels2r</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_base_scatter-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-2">Quick exercise</h4>

  <p>Rerun the above plot, but this time store it in an object. Next, plot
reading scores against math scores using the second formula method and
store it in another object. Visually compare the two, but for a more
formal test, use <code class="highlighter-rouge">identical(plot_1, plot_2)</code> on the two plot objects
to prove they are the same.</p>
</blockquote>

<h1 id="plots-using-ggplot2">Plots using ggplot2</h1>

<p>The first few times I tried to use ggplot2, I didn’t quite get it. But
once I did (and it doesn’t take too long!), I really started to like
it. It’s now my go-to system for making plots.</p>

<p>The <a href="http://ggplot2.tidyverse.org/reference/">ggplot2 system</a> is too
involved to cover in all of its details, but that’s kind of the point of
the grammar of graphics: once you see how it’s put together, you can
anticipate the commands you need to build your plot.</p>

<p>We’ll start by covering the same plots as above.</p>

<h2 id="histogram-1">Histogram</h2>

<p><a href="http://ggplot2.tidyverse.org">As the main help site says</a>, all ggplot2
plots need three things:</p>

<ul>
  <li>data</li>
  <li>how variables in the data map onto the plot (<em>e.g.</em>, what’s on the
x-axis? what’s on the y-axis)</li>
  <li>what kind of figure you want to make (<em>e.g.</em>, what do you want to
<strong>do</strong> with those data and mappings?)</li>
</ul>

<p>Depending on the plot you want to make, each of these pieces may be
called at different points in the command structure, which is usually
made up of linked functions like other tidyverse libraries. The key
difference between ggplot2 and dplyr, for example, is that while dplyr
uses the pipe (<code class="highlighter-rouge">%&gt;%</code>) to connect different functions, ggplot2 uses a
plus sign (<code class="highlighter-rouge">+</code>).</p>

<p>We’ll start by making a histogram again. To help make these pieces
clearer, I’ll use the argument names when possible. The first function,
which initializes the plot is <code class="highlighter-rouge">ggplot()</code>. Its first argument is the
data.</p>

<p>The aesthetic mappings, that is, which variables go where or how they
function on the plot, go inside the <code class="highlighter-rouge">aes()</code> function. Since we only have
one variable, <code class="highlighter-rouge">bynels2m</code>, it is assigned to <code class="highlighter-rouge">x</code>.</p>

<p>If we stop there and print…</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## init ggplot </span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_histogram_blank-1.png" width="100%" /></p>

<p>…nothing! Well, not nothing, but no histogram. That’s because the plot
object <code class="highlighter-rouge">p</code> knows the data and the key variable mapping but doesn’t know
what do with them. What do we want?</p>

<p>Since we want a histogram, we add the <code class="highlighter-rouge">geom_histogram()</code> function to the
existing plot object. Trying again…</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## add histogram instruction</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_histogram-1.png" width="100%" /></p>

<p>Success!</p>

<h2 id="density-1">Density</h2>

<p>Unlike the base R graphics system, ggplot2 does have a density plotting
command, <code class="highlighter-rouge">geom_density()</code>. We’ll go ahead and chain it to the first
command and print.</p>

<p>Notice how the function chain is the mostly the same as above, but (1)
written in a single linked chain and (2) using a different <code class="highlighter-rouge">geom_*()</code>
command at the end to indicate that we want something different.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## density</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_density</span><span class="p">()</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_density-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-3">Quick exercise</h4>

  <p>Make a density plot of reading scores.</p>
</blockquote>

<p>If we want to superimpose the density plot over the histogram, we only
need chain the two commands together with a slight modification in how
the histogram is made. This way, the histogram and the density will be
on the same scale.</p>

<p>The change happens in the <code class="highlighter-rouge">geom_histogram()</code> function, where we add a
new mapping: <code class="highlighter-rouge">aes(y = ..density..)</code>. (NOTE: this is similar to what we
did above in base R to make a histogram on a density scale.)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## histogram with density plot overlapping</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">..density..</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_density</span><span class="p">()</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_histdens-1.png" width="100%" /></p>

<p>It worked, but it’s not the greatest visual since the colors are the
same and the density plot is thin with no fill.</p>

<p>Adding to what came before, the <code class="highlighter-rouge">geom_histogram()</code> and <code class="highlighter-rouge">geom_density()</code>
both take on new arguments that change the defaults. Now the resulting
plot should look nicer and be easier to read.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## histogram with density plot overlapping (add color to see better)</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">..density..</span><span class="p">),</span><span class="w">
                   </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w">
                   </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'white'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_density</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_histdens_2-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-4">Quick exercise</h4>

  <p>Try changing some of the arguments in the last plot. What happens when
you change <code class="highlighter-rouge">alpha</code> (keep the value between 0 and 1)? What does the
<code class="highlighter-rouge">color</code> argument change? And <code class="highlighter-rouge">fill</code>? What happens if you switch the
<code class="highlighter-rouge">geom_*()</code> functions, call <code class="highlighter-rouge">geom_histogram()</code> after you call
<code class="highlighter-rouge">geom_density()</code>?</p>
</blockquote>

<h2 id="two-way">Two-way</h2>

<p>Plotting the difference in a continuous distribution across groups is a
common task. Let’s see the difference between student math scores
between students with parents who have any postsecondary degree and
those without.</p>

<p>Since we’re using data that was labelled in Stata, we’ll first use
<code class="highlighter-rouge">val_labels()</code> to check the <code class="highlighter-rouge">bypared</code> variable.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## get parental education levels, use `val_labels()` to show them</span><span class="w">
</span><span class="n">val_labels</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bypared</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                               {missing} 
                                      -9 
   {survey component legitimate skip/na} 
                                      -8 
                         {nonrespondent} 
                                      -4 
              did not finish high school 
                                       1 
       graduated from high school or ged 
                                       2 
       attended 2-year school, no degree 
                                       3 
            graduated from 2-year school 
                                       4 
      attended college, no 4-year degree 
                                       5 
                  graduated from college 
                                       6 
 completed master^s degree or equivalent 
                                       7 
completed phd, md, other advanced degree 
                                       8 
</code></pre></div></div>

<p>The way this variable is structured prevents us from using a <code class="highlighter-rouge">&gt;=</code> test
like we have been. We want to count parents with a two-year degree (<code class="highlighter-rouge">4</code>)
in addition to those having a Bachelor’s degree or higher (<code class="highlighter-rouge">6</code>, <code class="highlighter-rouge">7</code>, and
<code class="highlighter-rouge">8</code>), but we don’t want to count those who attended, but didn’t earn a
degree (<code class="highlighter-rouge">5</code>).</p>

<p>To do this, we’ll use the special operator <code class="highlighter-rouge">%in%</code> which does exactly
what it sounds like. If a value of <code class="highlighter-rouge">bypared</code> is <strong>in</strong> the set that we
give it, then the new indicator <code class="highlighter-rouge">pared_coll</code> will be 1; if not, 0.</p>

<p>The <code class="highlighter-rouge">ggplot()</code> function doesn’t need to use our full data. In fact, our
data needs to be set up a bit differently to make this plot. We’ll make
a new temporary data object that only has the data we need.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## need to set up data</span><span class="w">
</span><span class="n">plot_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">bypared</span><span class="p">,</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">na.omit</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">                       </span><span class="c1"># can't plot NAs, so drop them</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">pared_coll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">bypared</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">bypared</span><span class="p">)</span><span class="w"> 

</span><span class="c1">## show</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">plot_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 x 2
  bynels2m pared_coll
     &lt;dbl&gt;      &lt;dbl&gt;
1     47.8          0
2     55.3          0
3     66.2          0
4     35.3          0
5     30.0          0
6     24.3          0
</code></pre></div></div>

<p>To plot against the two groups we’ve made, we need to add it to the
aesthetic feature, <code class="highlighter-rouge">aes()</code>. The math score, <code class="highlighter-rouge">bynels2m</code>, is still mapped
to <code class="highlighter-rouge">x</code>, but since we want two side-by-side histograms, we set the <code class="highlighter-rouge">fill</code>
aesthetic to our new indicator variable. So the function knows that it’s
a group, we wrap it in the <code class="highlighter-rouge">factor()</code> function.</p>

<p>Finally, we add some changes to the <code class="highlighter-rouge">geom_histogram()</code> function so that
each group is on the same scale.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## two way histogram</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot_df</span><span class="p">,</span><span class="w">
            </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">pared_coll</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'density'</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'identity'</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_histogram_double-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-5">Quick exercise</h4>

  <p>Remove some of the new arguments in <code class="highlighter-rouge">geom_histogram()</code>. How does the
resulting plot change? Remove the <code class="highlighter-rouge">factor()</code> function from around
<code class="highlighter-rouge">pared_coll</code>: what happens?</p>
</blockquote>

<h2 id="box-plot-1">Box plot</h2>

<p>By this point, you’re hopefully seeing the pattern in how ggplot2
figures are put together. To make a box plot, we need to add a <code class="highlighter-rouge">y</code>
mapping to the <code class="highlighter-rouge">aes()</code> in addition to the <code class="highlighter-rouge">x</code> mapping. We don’t have to,
but we’ve also added the same variable to <code class="highlighter-rouge">fill</code> as we did to <code class="highlighter-rouge">x</code>. We do
this so that in addition to having different box and whisker plots along
the x-axis, each plot is given its own color.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## box plot using both factor() and as_factor()</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w">
            </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">bypared</span><span class="p">),</span><span class="w">
                          </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">,</span><span class="w">
                          </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as_factor</span><span class="p">(</span><span class="n">bypared</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_box-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-6">Quick exercise</h4>

  <p>Change the <code class="highlighter-rouge">as_factor()</code> and <code class="highlighter-rouge">factor()</code> functions above. How does the
plot change?</p>
</blockquote>

<h1 id="scatter-1">Scatter</h1>

<p>To make a scatter plot, make sure that the <code class="highlighter-rouge">aes()</code> has mappings for the
<code class="highlighter-rouge">x</code> axis and <code class="highlighter-rouge">y</code> axis and then use <code class="highlighter-rouge">geom_point()</code> to plot. To make
things easier to see, we’ll first reduce the data to 10% of the full
sample using <code class="highlighter-rouge">sample_frac()</code> from dplyr.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## sample 10% to make figure clearer</span><span class="w">
</span><span class="n">df_10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">sample_frac</span><span class="p">(</span><span class="m">0.1</span><span class="p">)</span><span class="w">

</span><span class="c1">## scatter</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_10</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_scatter_1-1.png" width="100%" /></p>

<p>Now that we have our scatter plot, let’s say that we want to add a third
dimension. Specifically, we want to change the color of each point based
on whether a student plans to earn a Bachelor’s degree or higher. That
means we need a new dummy variable that is 1 for those with BA/BS plans
and 0 for others.</p>

<p>We can look at the student base year expectations with <code class="highlighter-rouge">table()</code>…</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## see student base year plans</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bystexp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  -1    1    2    3    4    5    6    7 
1450  128  983  879  561 5416 3153 2666 
</code></pre></div></div>

<p>…but those numbers don’t tell us much. Since we read in a Stata data
file with labelled values, though, we can use the <code class="highlighter-rouge">val_labels()</code>
function to see our options.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## see how the labels map</span><span class="w">
</span><span class="n">val_labels</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">bystexp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   {survey component legitimate skip/na} 
                                      -8 
                         {nonrespondent} 
                                      -4 
                            {don^t know} 
                                      -1 
        less than high school graduation 
                                       1 
      high school graduation or ged only 
                                       2 
attend or complete 2-year college/school 
                                       3 
attend college, 4-year degree incomplete 
                                       4 
                   graduate from college 
                                       5 
    obtain master^s degree or equivalent 
                                       6 
obtain phd, md, or other advanced degree 
                                       7 
</code></pre></div></div>

<p>Now we see that <code class="highlighter-rouge">bystexp &gt;= 5</code> mean a student plans to earn a Bachelor’s
degree or higher. Let’s create that.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## create variable for students who plan to graduate from college</span><span class="w">
</span><span class="n">df_10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_10</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">plan_col_grad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">bystexp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Now that we have our new variable <code class="highlighter-rouge">plan_col_grad</code>, we can add it the
<code class="highlighter-rouge">color</code> aesthetic, <code class="highlighter-rouge">aes()</code> in <code class="highlighter-rouge">geom_point()</code>. Don’t forget to use
<code class="highlighter-rouge">factor()</code> so that ggplot knows to treat it like a group!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## scatter</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_10</span><span class="p">,</span><span class="w">
            </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">plan_col_grad</span><span class="p">)),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_scatter_2-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-7">Quick exercise</h4>

  <p>Change how you make <code class="highlighter-rouge">plan_col_grad</code> so that instead of 1 and 0, you
use ‘yes’ and ‘no’. Make your figure again. What changes?</p>
</blockquote>

<h2 id="fitted-lines">Fitted lines</h2>

<p>It’s often helpful to plot fitted lines against a scatter plot to help
see the underlying trend. There are a number of ways to do this with the
<code class="highlighter-rouge">geom_smooth()</code> function.</p>

<h3 id="linear-fit">Linear fit</h3>

<p>Setting <code class="highlighter-rouge">method = lm</code> in <code class="highlighter-rouge">geom_smooth()</code> will fit a simple straight line
with 95% confidence interval shaded around it.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## add fitted line with linear fit</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_10</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">plan_col_grad</span><span class="p">)),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_scatter_3-1.png" width="100%" /></p>

<h3 id="linear-fit-with-polynomials">Linear fit with polynomials</h3>

<p>In addition to the <code class="highlighter-rouge">method</code>, we can add a <code class="highlighter-rouge">formula</code> to allow the fitted
line to take a non-linear shape. Using the <code class="highlighter-rouge">aes()</code> values of <code class="highlighter-rouge">x</code> and
<code class="highlighter-rouge">y</code>, the argument below uses an R formula, <code class="highlighter-rouge">y ~ x</code>, but with the
addition of the <code class="highlighter-rouge">poly()</code> function. Setting the second argument in
<code class="highlighter-rouge">poly()</code> to 2 gives the line an extra quadratic term, which allows it to
take a more curved shape.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## add fitted line with polynomial linear fit</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_10</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">plan_col_grad</span><span class="p">)),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">poly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_scatter_4-1.png" width="100%" /></p>

<blockquote>
  <h4 id="quick-exercise-8">Quick exercise</h4>

  <p>Change the value in <code class="highlighter-rouge">poly()</code> to higher numbers. How does the line
change?</p>
</blockquote>

<h3 id="loess">Loess</h3>

<p>Finally, we can skip trying to adjust a linear line and just fit a
<a href="https://en.wikipedia.org/wiki/Local_regression">loess</a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## add fitted line with loess</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_10</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">plan_col_grad</span><span class="p">)),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loess</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<p><img src="figures/eda_plot_scatter_5-1.png" width="100%" /></p>

<h1 id="plotly">Plotly</h1>

<p>As a final example, we’ll turn our last plot into an interactive plotly
figure. <a href="https://plot.ly/d3-js-for-r-and-shiny-charts/">Plotly</a> works
with a number of languages, but it integrates really well with ggplot.
In fact, once the plot is made, we only have to use the <code class="highlighter-rouge">ggplotly()</code>
function to make it interactive.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## load plotly library</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Attaching package: 'plotly'
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following object is masked from 'package:ggplot2':

    last_plot

The following object is masked from 'package:stats':

    filter

The following object is masked from 'package:graphics':

    layout
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## create an interactive plot with the last figure</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplotly</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<!--html_preserve-->

<iframe src="./plotly/plotly/ptly_one.html">

</iframe>

<!--/html_preserve-->

<p>Other than the neat! factor, the plotly figure is great for pinpointing
outliers. Looking at the figure, hover over markers that seem outside
the expected value. Clearly, this can be a great tool for inspecting
your data.</p>

<p>Hovering over each point, however, it’s not immediately clear which
observation is being considered. Sure, we could record the math and
reading scores along with the <code class="highlighter-rouge">plan_col_grad</code> value and then search for
them in the data, but it would be much easier if we could change the
tooltip to give us a unique identifier, like the student ID.</p>

<p>Luckily, plotly will let us do this. We’ll remake the last plot in
ggplot2, but add a small bit to the <code class="highlighter-rouge">aes()</code> in the form of a <code class="highlighter-rouge">text</code>
argument. Instead of using the default tooltip values, we’ll <code class="highlighter-rouge">paste0()</code>
our own together, using friendly variable names and rounded values
(<code class="highlighter-rouge">round()</code>). So that the information looks neat, we’ll use HTML break
line commands, <code class="highlighter-rouge">&lt;br&gt;</code>, to separate each line. Finally, when we call
<code class="highlighter-rouge">ggplotly()</code> this time, we’ll change the <code class="highlighter-rouge">tooltip</code> argument from the
default <code class="highlighter-rouge">'all'</code> to <code class="highlighter-rouge">'text'</code> so it only includes our nicely formatted
text.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## redo last figure with addition of text in aes()</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_10</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bynels2r</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">plan_col_grad</span><span class="p">),</span><span class="w">
                             </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s1">'stu_id: '</span><span class="p">,</span><span class="w"> </span><span class="n">stu_id</span><span class="p">,</span><span class="w">
                                           </span><span class="s1">'&lt;br&gt;'</span><span class="p">,</span><span class="w">
                                           </span><span class="s1">'college?: '</span><span class="p">,</span><span class="w"> </span><span class="n">plan_col_grad</span><span class="p">,</span><span class="w">
                                           </span><span class="s1">'&lt;br&gt;'</span><span class="p">,</span><span class="w">
                                           </span><span class="s1">'math: '</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">bynels2m</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
                                           </span><span class="s1">'&lt;br&gt;'</span><span class="p">,</span><span class="w">
                                           </span><span class="s1">'read: '</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">bynels2r</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))),</span><span class="w">
               </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loess</span><span class="p">)</span><span class="w">

</span><span class="c1">## create an interactive plot, and limit tooltip to text argument above</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplotly</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">tooltip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'text'</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span></code></pre></div></div>

<!--html_preserve-->

<iframe src="./plotly/plotly/ptly_two.html">

</iframe>

<!--/html_preserve-->

<p>Now it’s really easy to find outliers!</p>

<blockquote>
  <h4 id="quick-exercise-9">Quick exercise</h4>

  <p>Use the plotly figure to inspect your data, particularly outliers.</p>
</blockquote>



      </section>
      <footer>
        <p>
  Benjamin Skinner</br>  
  Research Assistant Professor of Education</br>  
  University of Virginia</br>  
  <a href="https://www.btskinner.me" class="iconlink">
    <i class="fas fa-home fa-lg"></i></a> | 
  <a href="https://github.com/btskinner" class="iconlink">
    <i class="fab fa-github fa-lg"></i></a> | 
  <a href="mailto:btskinner@virginia.edu" class="iconlink">
    <i class="far fa-envelope fa-lg"></i></a> | 
  <a href="https://twitter.com/btskinner" class="iconlink">
    <i class="fab fa-twitter fa-lg"></i></a>
</p>
<p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>

      </footer>
    </div>
    <script src="/rworkshop/assets/js/scale.fix.js"></script>

    
    
    
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-63981025-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
